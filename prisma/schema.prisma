// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Note that some adapters may set a maximum length for the String type by default, please ensure your strings are long
// enough when changing adapters.
// See https://www.prisma.io/docs/orm/reference/prisma-schema-reference#string for more information
datasource db {
  provider = "sqlite"
  url      = "file:dev.sqlite"
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
  refreshToken        String?
  refreshTokenExpires DateTime?
}

model UpsellRule {
  id                String   @id @default(uuid())
  shop              String
  name              String?
  enabled           Boolean  @default(true)
  ruleType          String   // GLOBAL, TRIGGERED, GLOBAL_EXCEPT
  priority          Int      @default(0)
  
  // Trigger configuration (for TRIGGERED rule)
  triggerProducts   String?  // JSON array of product IDs
  triggerCollections String? // JSON array of collection IDs
  
  // Upsell configuration
  upsellProducts    String?  // JSON array of product IDs
  upsellCollections String?  // JSON array of collection IDs
  
  // Exclusion configuration (for GLOBAL_EXCEPT rule)
  excludedProducts  String?  // JSON array of product IDs
  excludedCollections String? // JSON array of collection IDs

  // Cart condition configuration (for CART_CONDITIONS rule)
  cartValueThreshold Int?     @default(0)
  
  // UI Configuration
  displayLimit      Int      @default(3)
  layout            String   @default("slider") // slider, vertical
  buttonText        String   @default("Add to Cart")
  showPrice         Boolean  @default(true)
  title             String   @default("Recommended for you")
  
  // Analytics
  trackViews        Boolean  @default(true)
  trackClicks       Boolean  @default(true)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([shop])
  @@index([ruleType])
}
